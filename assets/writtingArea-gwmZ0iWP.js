import{aa as ie,ab as ce,_ as de,R as ve,x as F,$ as c,a0 as V,c as s,a5 as e,a1 as n,af as me,W as _,ai as pe,aj as ge,ag as K,a9 as b,a6 as D,J,ao as O,a8 as A,aW as fe,a4 as t,a7 as ee,ak as Ve,al as _e}from"./index-DaJOda4c.js";import{b as he}from"./breadcrumbs-CijySQHn.js";import{c as ye,a as R,e as E,f as p,g as N,u as Se,d as v,V as be}from"./index.esm-Dng5Z6q6.js";import{V as L,a as m}from"./VRow-Dr0jI12L.js";import{V as W}from"./VAutocomplete-CPm032Tr.js";import{V as P}from"./VCheckbox-CNXD9nl_.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./filter-CZ0CM2ZC.js";import"./VMenu-HgnCpD9I.js";const d=$=>(Ve("data-v-239854ef"),$=$(),_e(),$),ke=d(()=>t("span",null,"演奏/演唱者：",-1)),Be=d(()=>t("span",null,"歌名：",-1)),Ae=d(()=>t("span",null,"曲風：",-1)),$e=d(()=>t("span",null,"BPM：",-1)),we=d(()=>t("span",null,"拍號：",-1)),Ne=d(()=>t("span",null,"/",-1)),Pe=d(()=>t("span",null,"隱私狀態：",-1)),Ce=d(()=>t("div",{class:"row-name-section"},null,-1)),Me=d(()=>t("div",{class:"row-name-beat"},null,-1)),Ue=d(()=>t("div",{class:"row-name-instrument"},"Hi-Hat",-1)),He=d(()=>t("div",{class:"row-name-instrument"},"小鼓",-1)),Te=d(()=>t("div",{class:"row-name-instrument"},"大鼓",-1)),qe={class:"sectionTitle"},Fe={class:"allBeats"},Ke={class:"beatTile"},De={class:"allNoteAreas"},Je={class:"HiHat-area noteArea w-100 d-flex"},Oe={class:"snare-area noteArea w-100 d-flex"},Re={class:"kick-area noteArea w-100 d-flex"},Ee={__name:"writtingArea",setup($){const{apiAuth:ae}=pe(),j=ce(),z=de(),le=z.account,G=ge(),{xl:se}=ve(),Q=["流行","龐克","金屬","後搖","慢搖","民謠","爵士","其他"],X=[2,3,4,6,9],Y=[2,4,8],h=F(!1),oe=ye({singer:R().required("演唱者必填-schema"),songTitle:R().required("歌名必填-schema"),songStyle:R().required("曲風必填-schema").test("isSongStyle","曲風分類錯誤-schema",r=>Q.includes(r)),BPM:E().typeError("格式錯誤，只能為數字-schema").required("BPM必填-schema"),signatureBeat:E().required("拍號必填").test("issignatureBeat","拍號錯誤",r=>X.includes(r)),signatureNote:E().required("拍號必填").test("issignatureNote","音符拍數錯誤",r=>Y.includes(r)),scoreHiHat:p().of(p().of(p().of(N()))),scoreSnare:p().of(p().of(p().of(N()))),scoreKick:p().of(p().of(p().of(N()))),isPublic:N()}),{handleSubmit:te,isSubmitting:Z}=Se({validationSchema:oe,initialValues:{singer:"",songTitle:"",songStyle:"",BPM:0,signatureBeat:4,signatureNote:4,scoreHiHat:[],scoreSnare:[],scoreKick:[],isPublic:!0}}),C=v("singer"),M=v("songTitle"),U=v("songStyle"),H=v("BPM"),g=v("signatureBeat"),x=v("signatureNote"),y=v("scoreHiHat"),k=v("scoreSnare"),B=v("scoreKick"),T=v("isPublic"),S=F(16),w=F(!1),re=()=>{z.isLogin||(alert("請先登入會員"),G.push("/")),w.value=!0,y.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),k.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),B.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),h.value=!h.value},ue=()=>{y.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),k.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),B.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),console.log("新增小節")},ne=te(async r=>{var l,o;try{const a=new FormData;a.append("editor",le),a.append("singer",r.singer),a.append("songTitle",r.songTitle),a.append("songStyle",r.songStyle),a.append("BPM",r.BPM),a.append("signatureBeat",r.signatureBeat),a.append("signatureNote",r.signatureNote),a.append("scoreHiHat",JSON.stringify(r.scoreHiHat)),a.append("scoreSnare",JSON.stringify(r.scoreSnare)),a.append("scoreKick",JSON.stringify(r.scoreKick)),a.append("isPublic",r.isPublic),await ae.post("/song",a),j({text:"建立歌曲成功",snackbarProps:{color:"green"}}),G.push("/myScore")}catch(a){console.log(a),j({text:((o=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:o.message)||"建立歌曲發生錯誤",snackbarProps:{color:"red"}})}});return(r,l)=>(c(),V(_,null,[s(e(he)),s(be,{onSubmit:me(e(ne),["prevent"]),disabled:e(Z)},{default:n(()=>[s(L,{id:"songInformation"},{default:n(()=>[s(m,{class:"v-col",cols:"12",md:"6"},{default:n(()=>[ke,s(K,{placeholder:"請輸入演奏/演唱者",modelValue:e(C).value.value,"onUpdate:modelValue":l[0]||(l[0]=o=>e(C).value.value=o),"error-messages":e(C).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),s(m,{class:"v-col",cols:"12",md:"6"},{default:n(()=>[Be,s(K,{placeholder:"請輸入歌名",modelValue:e(M).value.value,"onUpdate:modelValue":l[1]||(l[1]=o=>e(M).value.value=o),"error-messages":e(M).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),s(m,{class:"v-col",cols:"6",xl:"3"},{default:n(()=>[Ae,s(W,{label:"請選擇曲風",items:Q,modelValue:e(U).value.value,"onUpdate:modelValue":l[2]||(l[2]=o=>e(U).value.value=o),"error-messages":e(U).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),s(m,{class:"v-col",cols:"6",xl:"3"},{default:n(()=>[$e,s(K,{placeholder:"請輸入BPM",type:"number",min:"0",modelValue:e(H).value.value,"onUpdate:modelValue":l[3]||(l[3]=o=>e(H).value.value=o),"error-messages":e(H).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),s(m,{class:"v-col",cols:"6",xl:"3",id:"signature"},{default:n(()=>[we,s(W,{items:X,modelValue:e(g).value.value,"onUpdate:modelValue":l[4]||(l[4]=o=>e(g).value.value=o),disabled:h.value},null,8,["modelValue","disabled"]),Ne,s(W,{items:Y,modelValue:e(x).value.value,"onUpdate:modelValue":l[5]||(l[5]=o=>e(x).value.value=o),disabled:h.value},null,8,["modelValue","disabled"])]),_:1}),s(m,{class:"v-col",cols:"6",xl:"3"},{default:n(()=>[Pe,s(P,{label:"公開",modelValue:e(T).value.value,"onUpdate:modelValue":l[6]||(l[6]=o=>e(T).value.value=o),onChange:l[7]||(l[7]=o=>console.log(e(T).value.value))},null,8,["modelValue"])]),_:1})]),_:1}),s(L,null,{default:n(()=>[s(m,{cols:"12",class:"btns-nonstart"},{default:n(()=>[w.value?O("",!0):(c(),b(J,{key:0,onClick:l[8]||(l[8]=o=>re()),color:"black"},{default:n(()=>[D("開始寫譜")]),_:1}))]),_:1})]),_:1}),s(L,{id:"scoreArea",class:"h-100"},{default:n(()=>[(c(!0),V(_,null,A(e(y).value.value,(o,a)=>(c(),V(_,{key:a},[s(m,{cols:"2",class:fe(["instruments w-100",{displayNone:a%2==1&&e(se)}])},{default:n(()=>[Ce,Me,Ue,He,Te]),_:2},1032,["class"]),s(m,{cols:"10",xl:"5",class:"section v-col"},{default:n(()=>[t("div",qe,"section - "+ee(a+1),1),t("div",Fe,[(c(!0),V(_,null,A(o,(q,i)=>(c(),V("div",{class:"beat w-100",key:i},[t("div",Ke,"beat - "+ee(i+1),1),t("div",De,[t("div",Je,[(c(!0),V(_,null,A(q,(I,u)=>(c(),b(P,{class:"n-HiHat-note",key:u,value:!0,modelValue:e(y).value.value[a][i][u],"onUpdate:modelValue":f=>e(y).value.value[a][i][u]=f,onChange:f=>console.log(`${a+1}-${i+1}-${u+1}`,e(y).value.value[a][i][u])},null,8,["modelValue","onUpdate:modelValue","onChange"]))),128))]),t("div",Oe,[(c(!0),V(_,null,A(q,(I,u)=>(c(),b(P,{class:"n-snare-note",key:u,value:!0,modelValue:e(k).value.value[a][i][u],"onUpdate:modelValue":f=>e(k).value.value[a][i][u]=f,onChange:f=>console.log(`${a+1}-${i+1}-${u+1}`,e(k).value.value[a][i][u])},null,8,["modelValue","onUpdate:modelValue","onChange"]))),128))]),t("div",Re,[(c(!0),V(_,null,A(q,(I,u)=>(c(),b(P,{class:"n-kick-note",key:u,value:!0,modelValue:e(B).value.value[a][i][u],"onUpdate:modelValue":f=>e(B).value.value[a][i][u]=f,onChange:f=>console.log(`${a+1}-${i+1}-${u+1}`,e(B).value.value[a][i][u])},null,8,["modelValue","onUpdate:modelValue","onChange"]))),128))])])]))),128))])]),_:2},1024)],64))),128)),s(m,{cols:"12",class:"btns-start"},{default:n(()=>[w.value?(c(),b(J,{key:0,id:"btn-plus",onClick:l[9]||(l[9]=o=>ue()),disabled:!h.value,"prepend-icon":"mdi-plus",elevation:"0"},{default:n(()=>[D("新增小節")]),_:1},8,["disabled"])):O("",!0),w.value?(c(),b(J,{key:1,type:"submit",loading:e(Z),disabled:!h.value,color:"black","prepend-icon":"mdi-upload-multiple"},{default:n(()=>[D("上傳")]),_:1},8,["loading","disabled"])):O("",!0)]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])],64))}},xe=ie(Ee,[["__scopeId","data-v-239854ef"]]);export{xe as default};
