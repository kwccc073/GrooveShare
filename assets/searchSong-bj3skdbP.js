import{aa as L,ab as T,_ as h,x as t,$ as v,a0 as B,c,a5 as V,a1 as $,W as w,ag as F,ar as K,a9 as C,J as y,ao as M,ai as N}from"./index-DaJOda4c.js";import{b as D}from"./breadcrumbs-CijySQHn.js";import{V as E}from"./VDataTableServer-BeuF29Jj.js";import"./filter-CZ0CM2ZC.js";import"./VMenu-HgnCpD9I.js";const H={__name:"searchSong",setup(J){const k=T(),{apiAuth:A}=N(),n=h(),I=n.account,f=t(n.saving),g=t(10),o=t([{key:"createdAt",order:"desc"}]),r=t(1),p=t([]),U=[{title:"演唱/演奏者",align:"center",sortable:!0,key:"singer"},{title:"歌名",align:"center",sortable:!0,key:"songTitle"},{title:"曲風",align:"center",sortable:!0,key:"songStyle"},{title:"BPM",align:"center",sortable:!0,key:"BPM"},{title:"建立者",align:"center",sortable:!1,key:"editor"},{title:"",align:"center",sortable:!1,key:"action"}],m=t(!0),S=t(0),i=t(""),s=async u=>{var e,a,d,x;u&&(r.value=1),m.value=!0;try{const{data:l}=await A.get("/song/all",{params:{page:r.value,itemsPerPage:g.value,sortBy:((e=o.value[0])==null?void 0:e.key)||"createdAt",sortOrder:((a=o.value[0])==null?void 0:a.order)||"desc",search:i.value}});p.value.splice(0,p.value.length,...l.result.data),S.value=l.result.total}catch(l){console.log(l),k({text:((x=(d=l==null?void 0:l.response)==null?void 0:d.data)==null?void 0:x.message)||"發生錯誤",snackbarProps:{color:"red"}})}m.value=!1};s();const b=t(!1),P=async u=>{if(!n.isLogin){alert("請先登入帳號");return}b.value=!0;const e=await n.saveSong(u);k({text:e.text,snackbarProps:{color:e.color}}),f.value=n.saving,b.value=!1};return(u,e)=>(v(),B(w,null,[c(V(D)),c(E,{id:"table","fixed-header":"","items-per-page":g.value,"onUpdate:itemsPerPage":[e[3]||(e[3]=a=>g.value=a),e[6]||(e[6]=a=>s(!1))],"sort-by":o.value,"onUpdate:sortBy":[e[4]||(e[4]=a=>o.value=a),e[7]||(e[7]=a=>s(!1))],page:r.value,"onUpdate:page":[e[5]||(e[5]=a=>r.value=a),e[8]||(e[8]=a=>s(!1))],items:p.value,headers:U,loading:m.value,"items-length":S.value,search:i.value,hover:""},{top:$(()=>[c(F,{label:"搜尋（請輸入演唱/演奏者、歌名或曲風）",modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=a=>i.value=a),"append-icon":"mdi-magnify",onClickAppend:e[1]||(e[1]=a=>s(!0)),onKeydown:e[2]||(e[2]=K(a=>s(!0),["enter"]))},null,8,["modelValue"])]),"item.action":$(({item:a})=>[V(I)!==a.editor?(v(),B(w,{key:0},[f.value.includes(a._id)?(v(),C(y,{key:0,elevation:"0","prepend-icon":" mdi-cards-heart",onClick:d=>P(a._id)},null,8,["onClick"])):(v(),C(y,{key:1,elevation:"0","prepend-icon":" mdi-cards-heart-outline",onClick:d=>P(a._id),loading:b.value},null,8,["onClick","loading"]))],64)):M("",!0),c(y,{elevation:"0","prepend-icon":" mdi-file-eye-outline",to:"/songs/"+a._id},null,8,["to"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])],64))}},G=L(H,[["__scopeId","data-v-628db35a"]]);export{G as default};
