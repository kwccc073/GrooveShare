import{aa as z,ab as G,x as i,$ as Q,a0 as X,c as l,a1 as r,ah as Y,W as Z,ai as ee,a5 as s,J as f,a6 as P,ag as p,aq as ae,af as le,ac as te,ad as se,a7 as oe,ae as re,at as ne}from"./index-CWikNf2Y.js";import{c as ue,a as g,e as ie,u as de,d as v,V as me}from"./index.esm-9innt4fj.js";import{_ as ve}from"./breadcrumbs-BaZIdevb.js";import{g as pe}from"./index-DjKJqAo0.js";import{V as ge}from"./VContainer-DofNjeNN.js";import{V as _,a as u}from"./VRow-C0sq8wv9.js";import{V as ce}from"./VDataTableServer-C5X7v7fx.js";import{V as L}from"./filter-CtIy9tI0.js";import"./VMenu-CByEKNdx.js";const fe={__name:"searchTrainingRoom",setup(be){const{apiAuth:b}=ee(),c=G();i(null);const n=i({open:!1,id:""}),T=t=>{t?(n.value.id=t._id,V.value.value=t.city,y.value.value=t.district,k.value.value=t.address,N.value.value=t.trainingRoomName,R.value.value=t.phoneNumber,x.value.value=t.reservation,C.value.value=t.fee):n.value.id="",n.value.open=!0},F=()=>{n.value.open=!1,H()},A=["臺北市","新北市","桃園市","臺中市","臺南市","高雄市","基隆市","新竹市","嘉義市","宜蘭縣","新竹縣","苗栗縣","彰化縣","南投縣","雲林縣","嘉義縣","屏東縣","花蓮縣","臺東縣","澎湖縣"],B=["電話預約","官網預約","社群預約","現場登記","其他預約方式"],E=/^0\d{9}$/,K=ue({city:g().required("縣市必填-schema").test("isCity","地區分類錯誤-schema",t=>A.includes(t)),district:g().required("地區必填-schema"),address:g().required("地址必填-schema"),trainingRoomName:g().required("名稱必填-schema"),phoneNumber:g().required("連絡電話必填-schema").matches(E,"電話號碼格式不正確"),reservation:g().required("預約方式必填-schema").test("isreservation","預約方式分類錯誤-schema",t=>B.includes(t)),fee:ie().typeError("格式錯誤，只能為數字-schema").required("費用必填-schema").min(0,"費用不能小於 0")}),{handleSubmit:W,isSubmitting:U,resetForm:H}=de({validationSchema:K,initialValues:{city:"",district:"",address:"",trainingRoomName:"",phoneNumber:0,reservation:"",fee:0}}),V=v("city"),y=v("district"),k=v("address"),N=v("trainingRoomName"),R=v("phoneNumber"),x=v("reservation"),C=v("fee"),J=W(async t=>{var e,a;try{const o=new FormData;o.append("city",t.city),o.append("district",t.district),o.append("address",t.address),o.append("trainingRoomName",t.trainingRoomName),o.append("phoneNumber",t.phoneNumber),o.append("reservation",t.reservation),o.append("fee",t.fee),n.value.id===""?await b.post("/trainingRoom",o):await b.patch("/trainingRoom/"+n.value.id,o),c({text:n.value.id===""?"新增練鼓室成功":"編輯練鼓室成功",snackbarProps:{color:"green"}}),F(),d(!0)}catch(o){console.log(o),c({text:((a=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:a.message)||"發生錯誤-page",snackbarProps:{color:"red"}})}}),w=i(10),$=i([{key:"createdAt",order:"desc"}]),S=i(1),q=i([]),O=[{title:"縣市",align:"center",sortable:!0,key:"city"},{title:"地區",align:"center",sortable:!0,key:"district"},{title:"地址",align:"center",sortable:!1,key:"address"},{title:"名稱",align:"center",sortable:!1,key:"trainingRoomName"},{title:"連絡電話",align:"center",sortable:!1,key:"phoneNumber"},{title:"預約方式",align:"center",sortable:!1,key:"reservation"},{title:"費用（元/小時）",align:"center",sortable:!0,key:"fee"},{title:"",align:"center",sortable:!1,key:"action"}],M=i(!0),D=i(0),h=i(""),d=async t=>{var e,a,o,I;t&&(S.value=1),M.value=!0;try{const{data:m}=await b.get("/trainingRoom/all",{params:{page:S.value,itemsPerPage:w.value,sortBy:((e=$.value[0])==null?void 0:e.key)||"createdAt",sortOrder:((a=$.value[0])==null?void 0:a.order)||"desc",search:h.value}});q.value.splice(0,q.value.length,...m.result.data),D.value=m.result.total}catch(m){console.log(m),c({text:((I=(o=m==null?void 0:m.response)==null?void 0:o.data)==null?void 0:I.message)||"發生錯誤",snackbarProps:{color:"red"}})}M.value=!1};d();const j=t=>{var e,a;try{alert("確定要刪除練鼓室嗎？"),b.delete("/trainingRoom/"+t),c({text:"刪除歌曲成功",snackbarProps:{color:"green"}}),d()}catch(o){console.log(o),c({text:((a=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:a.message)||"刪除練鼓室發生錯誤",snackbarProps:{color:"red"}})}};return pe.to(".v-dialog",{x:500,duration:1}),(t,e)=>(Q(),X(Z,null,[l(ge,null,{default:r(()=>[l(_,null,{default:r(()=>[l(u,{cols:"6"},{default:r(()=>[l(s(ve))]),_:1}),l(u,{cols:"6",id:"col-btn"},{default:r(()=>[l(f,{onClick:e[0]||(e[0]=a=>T(null)),"prepend-icon":"mdi-plus"},{default:r(()=>[P("新增練鼓室")]),_:1})]),_:1}),l(u,{cols:"12"},{default:r(()=>[l(ce,{"items-per-page":w.value,"onUpdate:itemsPerPage":[e[4]||(e[4]=a=>w.value=a),e[7]||(e[7]=a=>d(!1))],"sort-by":$.value,"onUpdate:sortBy":[e[5]||(e[5]=a=>$.value=a),e[8]||(e[8]=a=>d(!1))],page:S.value,"onUpdate:page":[e[6]||(e[6]=a=>S.value=a),e[9]||(e[9]=a=>d(!1))],items:q.value,headers:O,loading:M.value,"items-length":D.value,search:h.value,hover:"",id:"table"},{top:r(()=>[l(p,{label:"搜尋（請輸入城市或名稱）",modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=a=>h.value=a),"append-icon":"mdi-magnify",onClickAppend:e[2]||(e[2]=a=>d(!0)),onKeydown:e[3]||(e[3]=ae(a=>d(!0),["enter"]))},null,8,["modelValue"])]),"item.action":r(({item:a})=>[l(f,{icon:"mdi-pencil",variant:"text",onClick:o=>T(a)},null,8,["onClick"]),l(f,{elevation:"0","prepend-icon":" mdi-trash-can-outline",onClick:o=>j(a._id)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),l(Y,{modelValue:n.value.open,"onUpdate:modelValue":e[17]||(e[17]=a=>n.value.open=a),persistent:"",width:"70vw"},{default:r(()=>[l(me,{onSubmit:le(s(J),["prevent"]),disabled:s(U)},{default:r(()=>[l(te,null,{default:r(()=>[l(se,null,{default:r(()=>[P(oe(n.value.id?"編輯練鼓室":"新增練鼓室"),1)]),_:1}),l(re,null,{default:r(()=>[l(_,null,{default:r(()=>[l(u,{cols:"12",md:"6"},{default:r(()=>[l(L,{label:"縣市",items:A,modelValue:s(V).value.value,"onUpdate:modelValue":e[10]||(e[10]=a=>s(V).value.value=a),"error-messages":s(V).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),l(u,{cols:"12",md:"6"},{default:r(()=>[l(p,{label:"地區",modelValue:s(y).value.value,"onUpdate:modelValue":e[11]||(e[11]=a=>s(y).value.value=a),"error-messages":s(y).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),l(u,{cols:"12"},{default:r(()=>[l(p,{label:"地址",modelValue:s(k).value.value,"onUpdate:modelValue":e[12]||(e[12]=a=>s(k).value.value=a),"error-messages":s(k).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),l(u,{cols:"12"},{default:r(()=>[l(p,{label:"名稱",modelValue:s(N).value.value,"onUpdate:modelValue":e[13]||(e[13]=a=>s(N).value.value=a),"error-messages":s(N).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),l(u,{cols:"12",md:"4"},{default:r(()=>[l(p,{label:"連絡電話",modelValue:s(R).value.value,"onUpdate:modelValue":e[14]||(e[14]=a=>s(R).value.value=a),"error-messages":s(R).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),l(u,{cols:"12",md:"4"},{default:r(()=>[l(L,{label:"預約方式",items:B,modelValue:s(x).value.value,"onUpdate:modelValue":e[15]||(e[15]=a=>s(x).value.value=a),"error-messages":s(x).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),l(u,{cols:"12",md:"4"},{default:r(()=>[l(p,{label:"費用（元/小時）",modelValue:s(C).value.value,"onUpdate:modelValue":e[16]||(e[16]=a=>s(C).value.value=a),"error-messages":s(C).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),l(ne,null,{default:r(()=>[l(f,{color:"red",loading:s(U),onClick:F},{default:r(()=>[P("取消")]),_:1},8,["loading"]),l(f,{color:"green",type:"submit",loading:s(U)},{default:r(()=>[P("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])],64))}},he=z(fe,[["__scopeId","data-v-6d6a06f1"]]);export{he as default};
