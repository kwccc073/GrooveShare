import{aa as I,ab as U,_ as L,x as t,$ as g,a9 as b,a1 as n,c as o,a5 as C,ag as T,aq as h,a0 as F,J as k,W as K,ao as M,ai as N}from"./index-CWikNf2Y.js";import{_ as q}from"./breadcrumbs-BaZIdevb.js";import{V as D}from"./VContainer-DofNjeNN.js";import{a as $,V as E}from"./VRow-C0sq8wv9.js";import{V as H}from"./VDataTableServer-C5X7v7fx.js";import"./filter-CtIy9tI0.js";import"./VMenu-CByEKNdx.js";const J={__name:"searchSong",setup(O){const V=U(),{apiAuth:w}=N(),r=L(),_=r.account,S=t(r.saving),p=t(10),i=t([{key:"createdAt",order:"desc"}]),u=t(1),m=t([]),A=[{title:"演唱/演奏者",align:"center",sortable:!0,key:"singer"},{title:"歌名",align:"center",sortable:!0,key:"songTitle"},{title:"曲風",align:"center",sortable:!0,key:"songStyle"},{title:"BPM",align:"center",sortable:!0,key:"BPM"},{title:"建立者",align:"center",sortable:!1,key:"editor"},{title:"",align:"center",sortable:!1,key:"action"}],f=t(!0),P=t(0),d=t(""),s=async c=>{var e,a,v,B;c&&(u.value=1),f.value=!0;try{const{data:l}=await w.get("/song/all",{params:{page:u.value,itemsPerPage:p.value,sortBy:((e=i.value[0])==null?void 0:e.key)||"createdAt",sortOrder:((a=i.value[0])==null?void 0:a.order)||"desc",search:d.value}});m.value.splice(0,m.value.length,...l.result.data),P.value=l.result.total}catch(l){console.log(l),V({text:((B=(v=l==null?void 0:l.response)==null?void 0:v.data)==null?void 0:B.message)||"發生錯誤",snackbarProps:{color:"red"}})}f.value=!1};s();const y=t(!1),x=async c=>{if(!r.isLogin){alert("請先登入帳號");return}y.value=!0;const e=await r.saveSong(c);V({text:e.text,snackbarProps:{color:e.color}}),S.value=r.saving,y.value=!1};return(c,e)=>(g(),b(D,null,{default:n(()=>[o(E,null,{default:n(()=>[o($,{cols:"12"},{default:n(()=>[o(C(q))]),_:1}),o($,{cols:"12"},{default:n(()=>[o(H,{"fixed-header":"","items-per-page":p.value,"onUpdate:itemsPerPage":[e[3]||(e[3]=a=>p.value=a),e[6]||(e[6]=a=>s(!1))],"sort-by":i.value,"onUpdate:sortBy":[e[4]||(e[4]=a=>i.value=a),e[7]||(e[7]=a=>s(!1))],page:u.value,"onUpdate:page":[e[5]||(e[5]=a=>u.value=a),e[8]||(e[8]=a=>s(!1))],items:m.value,headers:A,loading:f.value,"items-length":P.value,search:d.value,hover:""},{top:n(()=>[o(T,{label:"搜尋（請輸入演唱/演奏者、歌名或曲風）",modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),"append-icon":"mdi-magnify",onClickAppend:e[1]||(e[1]=a=>s(!0)),onKeydown:e[2]||(e[2]=h(a=>s(!0),["enter"]))},null,8,["modelValue"])]),"item.action":n(({item:a})=>[C(_)!==a.editor?(g(),F(K,{key:0},[S.value.includes(a._id)?(g(),b(k,{key:0,elevation:"0","prepend-icon":" mdi-cards-heart",onClick:v=>x(a._id)},null,8,["onClick"])):(g(),b(k,{key:1,elevation:"0","prepend-icon":" mdi-cards-heart-outline",onClick:v=>x(a._id),loading:y.value},null,8,["onClick","loading"]))],64)):M("",!0),o(k,{elevation:"0","prepend-icon":" mdi-file-eye-outline",to:"/songs/"+a._id},null,8,["to"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}))}},Y=I(J,[["__scopeId","data-v-ae591561"]]);export{Y as default};
