import{aa as j,ab as z,x as i,$ as G,a0 as Q,c as l,a5 as s,a1 as r,ah as X,W as Y,ai as Z,a4 as _,J as b,a6 as P,ag as p,ar as ee,af as ae,ac as le,at as te,ad as se,a7 as oe,ae as re,au as ne}from"./index-Cw5KbaNE.js";import{c as ie,a as c,e as ue,u as de,d as m,V as me}from"./index.esm-C7xn-ts7.js";import{b as ve}from"./breadcrumbs-BBQew8RT.js";import{g as pe}from"./index-DjKJqAo0.js";import{V as ce}from"./VDataTableServer-DjiRfRNS.js";import{V as ge,a as v}from"./VRow-Dk6N-hDo.js";import{V as be}from"./VAutocomplete-BYtqsStv.js";import{V as fe}from"./filter-DjF9y6tP.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VMenu-Cr6IGCWl.js";const Ve={id:"btn-and-search"},ye={__name:"searchTrainingRoom",setup(ke){const{apiAuth:f}=Z(),g=z();i(null);const n=i({open:!1,id:""}),q=t=>{t?(n.value.id=t._id,V.value.value=t.city,y.value.value=t.district,k.value.value=t.address,N.value.value=t.trainingRoomName,x.value.value=t.phoneNumber,R.value.value=t.reservation,h.value.value=t.fee):n.value.id="",n.value.open=!0},A=()=>{n.value.open=!1,W()},B=["臺北市","新北市","桃園市","臺中市","臺南市","高雄市","基隆市","新竹市","嘉義市","宜蘭縣","新竹縣","苗栗縣","彰化縣","南投縣","雲林縣","嘉義縣","屏東縣","花蓮縣","臺東縣","澎湖縣"],F=["電話預約","官網預約","社群預約","現場登記","其他預約方式"],L=/^0\d{9}$/,E=ie({city:c().required("縣市必填-schema").test("isCity","地區分類錯誤-schema",t=>B.includes(t)),district:c().required("地區必填-schema"),address:c().required("地址必填-schema"),trainingRoomName:c().required("名稱必填-schema"),phoneNumber:c().required("連絡電話必填-schema").matches(L,"電話號碼格式不正確"),reservation:c().required("預約方式必填-schema").test("isreservation","預約方式分類錯誤-schema",t=>F.includes(t)),fee:ue().typeError("格式錯誤，只能為數字-schema").required("費用必填-schema").min(0,"費用不能小於 0")}),{handleSubmit:K,isSubmitting:U,resetForm:W}=de({validationSchema:E,initialValues:{city:"",district:"",address:"",trainingRoomName:"",phoneNumber:0,reservation:"",fee:0}}),V=m("city"),y=m("district"),k=m("address"),N=m("trainingRoomName"),x=m("phoneNumber"),R=m("reservation"),h=m("fee"),H=K(async t=>{var e,a;try{const o=new FormData;o.append("city",t.city),o.append("district",t.district),o.append("address",t.address),o.append("trainingRoomName",t.trainingRoomName),o.append("phoneNumber",t.phoneNumber),o.append("reservation",t.reservation),o.append("fee",t.fee),n.value.id===""?await f.post("/trainingRoom",o):await f.patch("/trainingRoom/"+n.value.id,o),g({text:n.value.id===""?"新增練鼓室成功":"編輯練鼓室成功",snackbarProps:{color:"green"}}),A(),u(!0)}catch(o){console.log(o),g({text:((a=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:a.message)||"發生錯誤-page",snackbarProps:{color:"red"}})}}),w=i(10),C=i([{key:"createdAt",order:"desc"}]),S=i(1),M=i([]),J=[{title:"縣市",align:"center",sortable:!0,key:"city"},{title:"地區",align:"center",sortable:!0,key:"district"},{title:"地址",align:"center",sortable:!1,key:"address"},{title:"名稱",align:"center",sortable:!1,key:"trainingRoomName"},{title:"連絡電話",align:"center",sortable:!1,key:"phoneNumber"},{title:"預約方式",align:"center",sortable:!1,key:"reservation"},{title:"費用（元/小時）",align:"center",sortable:!0,key:"fee"},{title:"",align:"center",sortable:!1,key:"action"}],T=i(!0),D=i(0),$=i(""),u=async t=>{var e,a,o,I;t&&(S.value=1),T.value=!0;try{const{data:d}=await f.get("/trainingRoom/all",{params:{page:S.value,itemsPerPage:w.value,sortBy:((e=C.value[0])==null?void 0:e.key)||"createdAt",sortOrder:((a=C.value[0])==null?void 0:a.order)||"desc",search:$.value}});M.value.splice(0,M.value.length,...d.result.data),D.value=d.result.total}catch(d){console.log(d),g({text:((I=(o=d==null?void 0:d.response)==null?void 0:o.data)==null?void 0:I.message)||"發生錯誤",snackbarProps:{color:"red"}})}T.value=!1};u();const O=t=>{var e,a;try{alert("確定要刪除練鼓室嗎？"),f.delete("/trainingRoom/"+t),g({text:"刪除歌曲成功",snackbarProps:{color:"green"}}),u()}catch(o){console.log(o),g({text:((a=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:a.message)||"刪除練鼓室發生錯誤",snackbarProps:{color:"red"}})}};return pe.to(".v-dialog",{x:500,duration:1}),(t,e)=>(G(),Q(Y,null,[l(s(ve)),l(ce,{"items-per-page":w.value,"onUpdate:itemsPerPage":[e[4]||(e[4]=a=>w.value=a),e[7]||(e[7]=a=>u(!1))],"sort-by":C.value,"onUpdate:sortBy":[e[5]||(e[5]=a=>C.value=a),e[8]||(e[8]=a=>u(!1))],page:S.value,"onUpdate:page":[e[6]||(e[6]=a=>S.value=a),e[9]||(e[9]=a=>u(!1))],items:M.value,headers:J,loading:T.value,"items-length":D.value,search:$.value,hover:"",id:"table"},{top:r(()=>[_("div",Ve,[l(b,{onClick:e[0]||(e[0]=a=>q(null)),"prepend-icon":"mdi-plus",color:"black",id:"add-btn"},{default:r(()=>[P("新增練鼓室")]),_:1}),l(p,{label:"請搜尋城市或名稱",modelValue:$.value,"onUpdate:modelValue":e[1]||(e[1]=a=>$.value=a),"append-icon":"mdi-magnify",onClickAppend:e[2]||(e[2]=a=>u(!0)),onKeydown:e[3]||(e[3]=ee(a=>u(!0),["enter"])),"hide-details":""},null,8,["modelValue"])])]),"item.action":r(({item:a})=>[l(b,{class:"edit-and-delete",icon:"mdi-pencil",variant:"text",onClick:o=>q(a)},null,8,["onClick"]),l(b,{class:"edit-and-delete",icon:" mdi-trash-can-outline",variant:"text",onClick:o=>O(a._id)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"]),l(X,{modelValue:n.value.open,"onUpdate:modelValue":e[17]||(e[17]=a=>n.value.open=a),width:"70vw"},{default:r(()=>[l(me,{onSubmit:ae(s(H),["prevent"]),disabled:s(U)},{default:r(()=>[l(le,null,{default:r(()=>[l(b,{loading:s(U),onClick:A,id:"btn-close",elevation:"0"},{default:r(()=>[l(te,null,{default:r(()=>[P(" mdi-close ")]),_:1})]),_:1},8,["loading"]),l(se,null,{default:r(()=>[P(oe(n.value.id?"編輯練鼓室":"新增練鼓室"),1)]),_:1}),l(re,null,{default:r(()=>[l(ge,null,{default:r(()=>[l(v,{cols:"12",md:"6"},{default:r(()=>[l(be,{label:"縣市",items:B,modelValue:s(V).value.value,"onUpdate:modelValue":e[10]||(e[10]=a=>s(V).value.value=a),"error-messages":s(V).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),l(v,{cols:"12",md:"6"},{default:r(()=>[l(p,{label:"地區",modelValue:s(y).value.value,"onUpdate:modelValue":e[11]||(e[11]=a=>s(y).value.value=a),"error-messages":s(y).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),l(v,{cols:"12"},{default:r(()=>[l(p,{label:"地址",modelValue:s(k).value.value,"onUpdate:modelValue":e[12]||(e[12]=a=>s(k).value.value=a),"error-messages":s(k).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),l(v,{cols:"12"},{default:r(()=>[l(p,{label:"名稱",modelValue:s(N).value.value,"onUpdate:modelValue":e[13]||(e[13]=a=>s(N).value.value=a),"error-messages":s(N).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),l(v,{cols:"12",md:"4"},{default:r(()=>[l(p,{label:"連絡電話",modelValue:s(x).value.value,"onUpdate:modelValue":e[14]||(e[14]=a=>s(x).value.value=a),"error-messages":s(x).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),l(v,{cols:"12",md:"4"},{default:r(()=>[l(fe,{label:"預約方式",items:F,modelValue:s(R).value.value,"onUpdate:modelValue":e[15]||(e[15]=a=>s(R).value.value=a),"error-messages":s(R).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),l(v,{cols:"12",md:"4"},{default:r(()=>[l(p,{label:"費用（元/小時）",modelValue:s(h).value.value,"onUpdate:modelValue":e[16]||(e[16]=a=>s(h).value.value=a),"error-messages":s(h).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),l(ne,null,{default:r(()=>[l(b,{type:"submit",loading:s(U)},{default:r(()=>[P("新增")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])],64))}},Me=j(ye,[["__scopeId","data-v-f7f2caae"]]);export{Me as default};
