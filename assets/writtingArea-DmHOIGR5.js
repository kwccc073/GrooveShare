import{aa as ne,ab as ie,_ as ce,R as de,x as F,$ as c,a0 as V,c as s,a5 as e,a1 as n,af as ve,W as _,ai as me,aj as pe,ag as K,a9 as b,a6 as D,J,ao as O,a8 as A,aV as ge,a4 as t,a7 as x,ak as fe,al as Ve}from"./index-tF3WnsXk.js";import{b as _e}from"./breadcrumbs-BrApQjfA.js";import{c as he,a as R,e as E,h as p,i as w,u as ye,d as v,V as Se}from"./index.esm-IVbycjaY.js";import{V as j,a as m}from"./VRow-BxydngYz.js";import{V as z}from"./VAutocomplete-Cw8VDzQ0.js";import{V as N}from"./VCheckbox-Cg_yAdAw.js";import"./filter-DUy3X3Jp.js";import"./VMenu-BSnXu6uC.js";const d=$=>(fe("data-v-881085f0"),$=$(),Ve(),$),be=d(()=>t("span",null,"演奏/演唱者：",-1)),ke=d(()=>t("span",null,"歌名：",-1)),Be=d(()=>t("span",null,"曲風：",-1)),Ae=d(()=>t("span",null,"BPM：",-1)),$e=d(()=>t("span",null,"拍號：",-1)),Pe=d(()=>t("span",null,"/",-1)),we=d(()=>t("span",null,"隱私狀態：",-1)),Ne=d(()=>t("div",{class:"row-name-section"},null,-1)),Ce=d(()=>t("div",{class:"row-name-beat"},null,-1)),Me=d(()=>t("div",{class:"row-name-instrument"},"Hi-Hat",-1)),Ue=d(()=>t("div",{class:"row-name-instrument"},"小鼓",-1)),He=d(()=>t("div",{class:"row-name-instrument"},"大鼓",-1)),Te={class:"sectionTitle"},qe={class:"allBeats"},Fe={class:"beatTile"},Ke={class:"allNoteAreas"},De={class:"HiHat-area noteArea w-100 d-flex"},Je={class:"snare-area noteArea w-100 d-flex"},Oe={class:"kick-area noteArea w-100 d-flex"},Re={__name:"writtingArea",setup($){const{apiAuth:I}=me(),L=ie(),ee=ce().account,ae=pe(),{xl:le}=de(),W=["流行","龐克","金屬","後搖","慢搖","民謠","爵士","其他"],G=[2,3,4,6,9],Q=[2,4,8],h=F(!1),se=he({singer:R().required("演唱者必填-schema"),songTitle:R().required("歌名必填-schema"),songStyle:R().required("曲風必填-schema").test("isSongStyle","曲風分類錯誤-schema",r=>W.includes(r)),BPM:E().typeError("格式錯誤，只能為數字-schema").required("BPM必填-schema"),signatureBeat:E().required("拍號必填").test("issignatureBeat","拍號錯誤",r=>G.includes(r)),signatureNote:E().required("拍號必填").test("issignatureNote","音符拍數錯誤",r=>Q.includes(r)),scoreHiHat:p().of(p().of(p().of(w()))),scoreSnare:p().of(p().of(p().of(w()))),scoreKick:p().of(p().of(p().of(w()))),isPublic:w()}),{handleSubmit:oe,isSubmitting:X}=ye({validationSchema:se,initialValues:{singer:"",songTitle:"",songStyle:"",BPM:0,signatureBeat:4,signatureNote:4,scoreHiHat:[],scoreSnare:[],scoreKick:[],isPublic:!0}}),C=v("singer"),M=v("songTitle"),U=v("songStyle"),H=v("BPM"),g=v("signatureBeat"),Y=v("signatureNote"),y=v("scoreHiHat"),k=v("scoreSnare"),B=v("scoreKick"),T=v("isPublic"),S=F(16),P=F(!1),te=()=>{P.value=!0,y.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),k.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),B.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),h.value=!h.value},re=()=>{y.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),k.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),B.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),console.log("新增小節")},ue=oe(async r=>{var l,o;try{const a=new FormData;a.append("editor",ee),a.append("singer",r.singer),a.append("songTitle",r.songTitle),a.append("songStyle",r.songStyle),a.append("BPM",r.BPM),a.append("signatureBeat",r.signatureBeat),a.append("signatureNote",r.signatureNote),a.append("scoreHiHat",JSON.stringify(r.scoreHiHat)),a.append("scoreSnare",JSON.stringify(r.scoreSnare)),a.append("scoreKick",JSON.stringify(r.scoreKick)),a.append("isPublic",r.isPublic),console.log("isPublic的資料型態為",typeof r.isPublic),await I.post("/song",a),L({text:"建立歌曲成功",snackbarProps:{color:"green"}}),ae.push("/myScore")}catch(a){console.log(a),L({text:((o=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:o.message)||"建立歌曲發生錯誤",snackbarProps:{color:"red"}})}});return(r,l)=>(c(),V(_,null,[s(e(_e)),s(Se,{onSubmit:ve(e(ue),["prevent"]),disabled:e(X)},{default:n(()=>[s(j,{id:"songInformation"},{default:n(()=>[s(m,{class:"v-col",cols:"12",md:"6"},{default:n(()=>[be,s(K,{placeholder:"請輸入演奏/演唱者",modelValue:e(C).value.value,"onUpdate:modelValue":l[0]||(l[0]=o=>e(C).value.value=o),"error-messages":e(C).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),s(m,{class:"v-col",cols:"12",md:"6"},{default:n(()=>[ke,s(K,{placeholder:"請輸入歌名",modelValue:e(M).value.value,"onUpdate:modelValue":l[1]||(l[1]=o=>e(M).value.value=o),"error-messages":e(M).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),s(m,{class:"v-col",cols:"6",xl:"3"},{default:n(()=>[Be,s(z,{label:"請選擇曲風",items:W,modelValue:e(U).value.value,"onUpdate:modelValue":l[2]||(l[2]=o=>e(U).value.value=o),"error-messages":e(U).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),s(m,{class:"v-col",cols:"6",xl:"3"},{default:n(()=>[Ae,s(K,{placeholder:"請輸入BPM",type:"number",min:"0",modelValue:e(H).value.value,"onUpdate:modelValue":l[3]||(l[3]=o=>e(H).value.value=o),"error-messages":e(H).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),s(m,{class:"v-col",cols:"6",xl:"3",id:"signature"},{default:n(()=>[$e,s(z,{items:G,modelValue:e(g).value.value,"onUpdate:modelValue":l[4]||(l[4]=o=>e(g).value.value=o),disabled:h.value},null,8,["modelValue","disabled"]),Pe,s(z,{items:Q,modelValue:e(Y).value.value,"onUpdate:modelValue":l[5]||(l[5]=o=>e(Y).value.value=o),disabled:h.value},null,8,["modelValue","disabled"])]),_:1}),s(m,{class:"v-col",cols:"6",xl:"3"},{default:n(()=>[we,s(N,{label:"公開",modelValue:e(T).value.value,"onUpdate:modelValue":l[6]||(l[6]=o=>e(T).value.value=o),onChange:l[7]||(l[7]=o=>console.log(e(T).value.value))},null,8,["modelValue"])]),_:1})]),_:1}),s(j,null,{default:n(()=>[s(m,{cols:"12",class:"btns-nonstart"},{default:n(()=>[P.value?O("",!0):(c(),b(J,{key:0,onClick:l[8]||(l[8]=o=>te()),color:"black"},{default:n(()=>[D("開始寫譜")]),_:1}))]),_:1})]),_:1}),s(j,{id:"scoreArea",class:"h-100"},{default:n(()=>[(c(!0),V(_,null,A(e(y).value.value,(o,a)=>(c(),V(_,{key:a},[s(m,{cols:"2",class:ge(["instruments w-100",{displayNone:a%2==1&&e(le)}])},{default:n(()=>[Ne,Ce,Me,Ue,He]),_:2},1032,["class"]),s(m,{cols:"10",xl:"5",class:"section v-col"},{default:n(()=>[t("div",Te,"section - "+x(a+1),1),t("div",qe,[(c(!0),V(_,null,A(o,(q,i)=>(c(),V("div",{class:"beat w-100",key:i},[t("div",Fe,"beat - "+x(i+1),1),t("div",Ke,[t("div",De,[(c(!0),V(_,null,A(q,(Z,u)=>(c(),b(N,{class:"n-HiHat-note",key:u,value:!0,modelValue:e(y).value.value[a][i][u],"onUpdate:modelValue":f=>e(y).value.value[a][i][u]=f,onChange:f=>console.log(`${a+1}-${i+1}-${u+1}`,e(y).value.value[a][i][u])},null,8,["modelValue","onUpdate:modelValue","onChange"]))),128))]),t("div",Je,[(c(!0),V(_,null,A(q,(Z,u)=>(c(),b(N,{class:"n-snare-note",key:u,value:!0,modelValue:e(k).value.value[a][i][u],"onUpdate:modelValue":f=>e(k).value.value[a][i][u]=f,onChange:f=>console.log(`${a+1}-${i+1}-${u+1}`,e(k).value.value[a][i][u])},null,8,["modelValue","onUpdate:modelValue","onChange"]))),128))]),t("div",Oe,[(c(!0),V(_,null,A(q,(Z,u)=>(c(),b(N,{class:"n-kick-note",key:u,value:!0,modelValue:e(B).value.value[a][i][u],"onUpdate:modelValue":f=>e(B).value.value[a][i][u]=f,onChange:f=>console.log(`${a+1}-${i+1}-${u+1}`,e(B).value.value[a][i][u])},null,8,["modelValue","onUpdate:modelValue","onChange"]))),128))])])]))),128))])]),_:2},1024)],64))),128)),s(m,{cols:"12",class:"btns-start"},{default:n(()=>[P.value?(c(),b(J,{key:0,id:"btn-plus",onClick:l[9]||(l[9]=o=>re()),disabled:!h.value,"prepend-icon":"mdi-plus",elevation:"0"},{default:n(()=>[D("新增小節")]),_:1},8,["disabled"])):O("",!0),P.value?(c(),b(J,{key:1,type:"submit",loading:e(X),disabled:!h.value,color:"black","prepend-icon":"mdi-upload-multiple"},{default:n(()=>[D("上傳")]),_:1},8,["loading","disabled"])):O("",!0)]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])],64))}},Ze=ne(Re,[["__scopeId","data-v-881085f0"]]);export{Ze as default};
