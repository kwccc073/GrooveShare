import{aa as me,ab as pe,_ as ge,R as fe,A as he,x as E,$ as i,a0 as h,c as o,a5 as e,a1 as u,af as Ve,W as _,ai as _e,aj as ye,ag as L,a9 as y,a6 as w,J as M,ao as N,a8 as $,aW as be,a4 as r,a7 as le,ak as Se,al as ke}from"./index-Cw5KbaNE.js";import{b as Ae}from"./breadcrumbs-BBQew8RT.js";import{c as Be,a as R,e as W,f as p,g as C,u as $e,d as v,V as Pe}from"./index.esm-C7xn-ts7.js";import{V as j,a as m}from"./VRow-Dk6N-hDo.js";import{V as z}from"./VAutocomplete-BYtqsStv.js";import{V as U}from"./VCheckbox-BqgSR_sL.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./filter-DjF9y6tP.js";import"./VMenu-Cr6IGCWl.js";const c=P=>(Se("data-v-c4be65e6"),P=P(),ke(),P),we=c(()=>r("span",null,"演奏/演唱者：",-1)),Me=c(()=>r("span",null,"歌名：",-1)),Ne=c(()=>r("span",null,"曲風：",-1)),Ce=c(()=>r("span",null,"BPM：",-1)),Ue=c(()=>r("span",null,"拍號：",-1)),He=c(()=>r("span",null,"/",-1)),Te=c(()=>r("span",null,"隱私狀態：",-1)),qe=c(()=>r("div",{class:"row-name-section"},null,-1)),Fe=c(()=>r("div",{class:"row-name-beat"},null,-1)),Ke=c(()=>r("div",{class:"row-name-instrument"},"Hi-Hat",-1)),De=c(()=>r("div",{class:"row-name-instrument"},"小鼓",-1)),Je=c(()=>r("div",{class:"row-name-instrument"},"大鼓",-1)),Oe={class:"sectionTitle"},Ee={class:"allBeats"},Le={class:"beatTile"},Re={class:"allNoteAreas"},We={class:"HiHat-area noteArea w-100 d-flex"},je={class:"snare-area noteArea w-100 d-flex"},ze={class:"kick-area noteArea w-100 d-flex"},Qe={__name:"writtingArea",setup(P){const{apiAuth:se}=_e(),H=pe(),Q=ge(),oe=Q.account,T=ye(),{xl:te}=fe(),G=window.matchMedia("(orientation: portrait)");function re(){return/Mobi|Android|iPhone|iPad|iPod/.test(navigator.userAgent)}function X(t){re()&&t.matches&&H({text:"建議將裝置轉為橫向",snackbarProps:{color:"blue"}})}he(()=>{X(G)}),G.addEventListener("change",X);const Y=["流行","龐克","金屬","後搖","慢搖","民謠","爵士","其他"],Z=[2,3,4,6,9],x=[2,4,8],V=E(!1),ue=Be({singer:R().required("演唱者必填-schema"),songTitle:R().required("歌名必填-schema"),songStyle:R().required("曲風必填-schema").test("isSongStyle","曲風分類錯誤-schema",t=>Y.includes(t)),BPM:W().typeError("格式錯誤，只能為數字-schema").required("BPM必填-schema"),signatureBeat:W().required("拍號必填").test("issignatureBeat","拍號錯誤",t=>Z.includes(t)),signatureNote:W().required("拍號必填").test("issignatureNote","音符拍數錯誤",t=>x.includes(t)),scoreHiHat:p().of(p().of(p().of(C()))),scoreSnare:p().of(p().of(p().of(C()))),scoreKick:p().of(p().of(p().of(C()))),isPublic:C()}),{handleSubmit:ne,isSubmitting:I}=$e({validationSchema:ue,initialValues:{singer:"",songTitle:"",songStyle:"",BPM:0,signatureBeat:4,signatureNote:4,scoreHiHat:[],scoreSnare:[],scoreKick:[],isPublic:!0}}),q=v("singer"),F=v("songTitle"),K=v("songStyle"),D=v("BPM"),g=v("signatureBeat"),ee=v("signatureNote"),b=v("scoreHiHat"),k=v("scoreSnare"),A=v("scoreKick"),J=v("isPublic"),S=E(16),B=E(!1),ie=()=>{Q.isLogin||(alert("請先登入會員"),T.push("/")),B.value=!0,b.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),k.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),A.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),V.value=!V.value},de=()=>{alert("確定要離開寫譜專區嗎？"),T.push("/profile")},ce=()=>{b.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),k.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),A.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),console.log("新增小節")},ve=ne(async t=>{var l,s;try{const a=new FormData;a.append("editor",oe),a.append("singer",t.singer),a.append("songTitle",t.songTitle),a.append("songStyle",t.songStyle),a.append("BPM",t.BPM),a.append("signatureBeat",t.signatureBeat),a.append("signatureNote",t.signatureNote),a.append("scoreHiHat",JSON.stringify(t.scoreHiHat)),a.append("scoreSnare",JSON.stringify(t.scoreSnare)),a.append("scoreKick",JSON.stringify(t.scoreKick)),a.append("isPublic",t.isPublic),await se.post("/song",a),H({text:"建立歌曲成功",snackbarProps:{color:"green"}}),T.push("/myScore")}catch(a){console.log(a),H({text:((s=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:s.message)||"建立歌曲發生錯誤",snackbarProps:{color:"red"}})}});return(t,l)=>(i(),h(_,null,[o(e(Ae)),o(Pe,{onSubmit:Ve(e(ve),["prevent"]),disabled:e(I)},{default:u(()=>[o(j,{id:"songInformation"},{default:u(()=>[o(m,{class:"v-col",cols:"12",md:"6"},{default:u(()=>[we,o(L,{placeholder:"請輸入演奏/演唱者",modelValue:e(q).value.value,"onUpdate:modelValue":l[0]||(l[0]=s=>e(q).value.value=s),"error-messages":e(q).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),o(m,{class:"v-col",cols:"12",md:"6"},{default:u(()=>[Me,o(L,{placeholder:"請輸入歌名",modelValue:e(F).value.value,"onUpdate:modelValue":l[1]||(l[1]=s=>e(F).value.value=s),"error-messages":e(F).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),o(m,{class:"v-col",cols:"6",xl:"3"},{default:u(()=>[Ne,o(z,{label:"請選擇曲風",items:Y,modelValue:e(K).value.value,"onUpdate:modelValue":l[2]||(l[2]=s=>e(K).value.value=s),"error-messages":e(K).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),o(m,{class:"v-col",cols:"6",xl:"3"},{default:u(()=>[Ce,o(L,{placeholder:"請輸入BPM",type:"number",min:"0",modelValue:e(D).value.value,"onUpdate:modelValue":l[3]||(l[3]=s=>e(D).value.value=s),"error-messages":e(D).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),o(m,{class:"v-col",cols:"6",xl:"3",id:"signature"},{default:u(()=>[Ue,o(z,{items:Z,modelValue:e(g).value.value,"onUpdate:modelValue":l[4]||(l[4]=s=>e(g).value.value=s),disabled:V.value},null,8,["modelValue","disabled"]),He,o(z,{items:x,modelValue:e(ee).value.value,"onUpdate:modelValue":l[5]||(l[5]=s=>e(ee).value.value=s),disabled:V.value},null,8,["modelValue","disabled"])]),_:1}),o(m,{class:"v-col",cols:"6",xl:"3"},{default:u(()=>[Te,o(U,{label:"公開",modelValue:e(J).value.value,"onUpdate:modelValue":l[6]||(l[6]=s=>e(J).value.value=s),onChange:l[7]||(l[7]=s=>console.log(e(J).value.value))},null,8,["modelValue"])]),_:1})]),_:1}),o(j,null,{default:u(()=>[o(m,{cols:"12",class:"btns-nonstart"},{default:u(()=>[B.value?N("",!0):(i(),y(M,{key:0,onClick:l[8]||(l[8]=s=>ie()),color:"black"},{default:u(()=>[w("開始寫譜")]),_:1}))]),_:1})]),_:1}),o(j,{id:"scoreArea",class:"h-100"},{default:u(()=>[(i(!0),h(_,null,$(e(b).value.value,(s,a)=>(i(),h(_,{key:a},[o(m,{cols:"2",class:be(["instruments w-100",{displayNone:a%2==1&&e(te)}])},{default:u(()=>[qe,Fe,Ke,De,Je]),_:2},1032,["class"]),o(m,{cols:"10",xl:"5",class:"section v-col"},{default:u(()=>[r("div",Oe,"section - "+le(a+1),1),r("div",Ee,[(i(!0),h(_,null,$(s,(O,d)=>(i(),h("div",{class:"beat w-100",key:d},[r("div",Le,"beat - "+le(d+1),1),r("div",Re,[r("div",We,[(i(!0),h(_,null,$(O,(ae,n)=>(i(),y(U,{class:"n-HiHat-note",key:n,value:!0,modelValue:e(b).value.value[a][d][n],"onUpdate:modelValue":f=>e(b).value.value[a][d][n]=f,onChange:f=>console.log(`${a+1}-${d+1}-${n+1}`,e(b).value.value[a][d][n])},null,8,["modelValue","onUpdate:modelValue","onChange"]))),128))]),r("div",je,[(i(!0),h(_,null,$(O,(ae,n)=>(i(),y(U,{class:"n-snare-note",key:n,value:!0,modelValue:e(k).value.value[a][d][n],"onUpdate:modelValue":f=>e(k).value.value[a][d][n]=f,onChange:f=>console.log(`${a+1}-${d+1}-${n+1}`,e(k).value.value[a][d][n])},null,8,["modelValue","onUpdate:modelValue","onChange"]))),128))]),r("div",ze,[(i(!0),h(_,null,$(O,(ae,n)=>(i(),y(U,{class:"n-kick-note",key:n,value:!0,modelValue:e(A).value.value[a][d][n],"onUpdate:modelValue":f=>e(A).value.value[a][d][n]=f,onChange:f=>console.log(`${a+1}-${d+1}-${n+1}`,e(A).value.value[a][d][n])},null,8,["modelValue","onUpdate:modelValue","onChange"]))),128))])])]))),128))])]),_:2},1024)],64))),128)),o(m,{cols:"12",class:"btns-start"},{default:u(()=>[B.value?(i(),y(M,{key:0,id:"btn-close",onClick:l[9]||(l[9]=s=>de()),disabled:!V.value,"prepend-icon":"mdi-close",elevation:"0",color:"red"},{default:u(()=>[w("離開")]),_:1},8,["disabled"])):N("",!0),B.value?(i(),y(M,{key:1,id:"btn-plus",onClick:l[10]||(l[10]=s=>ce()),disabled:!V.value,"prepend-icon":"mdi-plus",elevation:"0"},{default:u(()=>[w("新增小節")]),_:1},8,["disabled"])):N("",!0),B.value?(i(),y(M,{key:2,id:"btn-upload",type:"submit",loading:e(I),disabled:!V.value,color:"black","prepend-icon":"mdi-upload-multiple",elevation:"0"},{default:u(()=>[w("上傳")]),_:1},8,["loading","disabled"])):N("",!0)]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])],64))}},sa=me(Qe,[["__scopeId","data-v-c4be65e6"]]);export{sa as default};
