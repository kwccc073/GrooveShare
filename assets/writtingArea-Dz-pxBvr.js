import{aa as ne,ab as ie,_ as ce,R as de,x as K,$ as c,a9 as _,a1 as t,ai as ve,aj as me,c as l,a5 as e,ag as D,J,a6 as O,ao as R,a0 as V,a8 as A,W as b,af as pe,aV as ge,a4 as u,a7 as x,ak as fe,al as _e}from"./index-CWikNf2Y.js";import{_ as Ve}from"./breadcrumbs-BaZIdevb.js";import{c as he,a as E,e as j,h as p,i as w,u as ye,d as m,V as Se}from"./index.esm-9innt4fj.js";import{V as be}from"./VContainer-DofNjeNN.js";import{a as v,V as N}from"./VRow-C0sq8wv9.js";import{V as z,a as C}from"./VAutocomplete-BAaFLQCl.js";import"./filter-CtIy9tI0.js";import"./VMenu-CByEKNdx.js";const d=$=>(fe("data-v-d8a07592"),$=$(),_e(),$),Be=d(()=>u("span",null,"演奏/演唱者：",-1)),ke=d(()=>u("span",null,"歌名：",-1)),Ae=d(()=>u("span",null,"曲風：",-1)),$e=d(()=>u("span",null,"BPM：",-1)),Pe=d(()=>u("span",null,"拍號：",-1)),we=d(()=>u("span",null,"/",-1)),Ne=d(()=>u("span",null,"隱私狀態：",-1)),Ce=d(()=>u("div",{class:"row-name-section"},null,-1)),Me=d(()=>u("div",{class:"row-name-beat"},null,-1)),Ue=d(()=>u("div",{class:"row-name-instrument"},"Hi-Hat",-1)),He=d(()=>u("div",{class:"row-name-instrument"},"小鼓",-1)),Te=d(()=>u("div",{class:"row-name-instrument"},"大鼓",-1)),qe={class:"sectionTitle"},Fe={class:"allBeats"},Ke={class:"beatTile"},De={class:"allNoteAreas"},Je={class:"HiHat-area noteArea w-100 d-flex"},Oe={class:"snare-area noteArea w-100 d-flex"},Re={class:"kick-area noteArea w-100 d-flex"},Ee={__name:"writtingArea",setup($){const{apiAuth:I}=ve(),L=ie(),ee=ce().account,ae=me(),{xl:le}=de(),W=["流行","龐克","金屬","後搖","慢搖","民謠","爵士","其他"],G=[2,3,4,6,9],Q=[2,4,8],h=K(!1),se=he({singer:E().required("演唱者必填-schema"),songTitle:E().required("歌名必填-schema"),songStyle:E().required("曲風必填-schema").test("isSongStyle","曲風分類錯誤-schema",r=>W.includes(r)),BPM:j().typeError("格式錯誤，只能為數字-schema").required("BPM必填-schema"),signatureBeat:j().required("拍號必填").test("issignatureBeat","拍號錯誤",r=>G.includes(r)),signatureNote:j().required("拍號必填").test("issignatureNote","音符拍數錯誤",r=>Q.includes(r)),scoreHiHat:p().of(p().of(p().of(w()))),scoreSnare:p().of(p().of(p().of(w()))),scoreKick:p().of(p().of(p().of(w()))),isPublic:w()}),{handleSubmit:oe,isSubmitting:X}=ye({validationSchema:se,initialValues:{singer:"",songTitle:"",songStyle:"",BPM:0,signatureBeat:4,signatureNote:4,scoreHiHat:[],scoreSnare:[],scoreKick:[],isPublic:!0}}),M=m("singer"),U=m("songTitle"),H=m("songStyle"),T=m("BPM"),g=m("signatureBeat"),Y=m("signatureNote"),y=m("scoreHiHat"),B=m("scoreSnare"),k=m("scoreKick"),q=m("isPublic"),S=K(16),P=K(!1),te=()=>{P.value=!0,y.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),B.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),k.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),h.value=!h.value},ue=()=>{y.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),B.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),k.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),console.log("新增小節")},re=oe(async r=>{var s,o;try{const a=new FormData;a.append("editor",ee),a.append("singer",r.singer),a.append("songTitle",r.songTitle),a.append("songStyle",r.songStyle),a.append("BPM",r.BPM),a.append("signatureBeat",r.signatureBeat),a.append("signatureNote",r.signatureNote),a.append("scoreHiHat",JSON.stringify(r.scoreHiHat)),a.append("scoreSnare",JSON.stringify(r.scoreSnare)),a.append("scoreKick",JSON.stringify(r.scoreKick)),a.append("isPublic",r.isPublic),console.log("isPublic的資料型態為",typeof r.isPublic),await I.post("/song",a),L({text:"建立歌曲成功",snackbarProps:{color:"green"}}),ae.push("/myScore")}catch(a){console.log(a),L({text:((o=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:o.message)||"建立歌曲發生錯誤",snackbarProps:{color:"red"}})}});return(r,s)=>(c(),_(be,null,{default:t(()=>[l(N,null,{default:t(()=>[l(v,{cols:"12"},{default:t(()=>[l(e(Ve))]),_:1})]),_:1}),l(Se,{onSubmit:pe(e(re),["prevent"]),disabled:e(X)},{default:t(()=>[l(N,{id:"songInformation"},{default:t(()=>[l(v,{class:"v-col",cols:"12",md:"6"},{default:t(()=>[Be,l(D,{placeholder:"請輸入演奏/演唱者",modelValue:e(M).value.value,"onUpdate:modelValue":s[0]||(s[0]=o=>e(M).value.value=o),"error-messages":e(M).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),l(v,{class:"v-col",cols:"12",md:"6"},{default:t(()=>[ke,l(D,{placeholder:"請輸入歌名",modelValue:e(U).value.value,"onUpdate:modelValue":s[1]||(s[1]=o=>e(U).value.value=o),"error-messages":e(U).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),l(v,{class:"v-col",cols:"6",xl:"3"},{default:t(()=>[Ae,l(z,{label:"請選擇曲風",items:W,modelValue:e(H).value.value,"onUpdate:modelValue":s[2]||(s[2]=o=>e(H).value.value=o),"error-messages":e(H).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),l(v,{class:"v-col",cols:"6",xl:"3"},{default:t(()=>[$e,l(D,{placeholder:"請輸入BPM",type:"number",min:"0",modelValue:e(T).value.value,"onUpdate:modelValue":s[3]||(s[3]=o=>e(T).value.value=o),"error-messages":e(T).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),l(v,{class:"v-col",cols:"6",xl:"3",id:"signature"},{default:t(()=>[Pe,l(z,{items:G,modelValue:e(g).value.value,"onUpdate:modelValue":s[4]||(s[4]=o=>e(g).value.value=o),disabled:h.value},null,8,["modelValue","disabled"]),we,l(z,{items:Q,modelValue:e(Y).value.value,"onUpdate:modelValue":s[5]||(s[5]=o=>e(Y).value.value=o),disabled:h.value},null,8,["modelValue","disabled"])]),_:1}),l(v,{class:"v-col",cols:"6",xl:"3"},{default:t(()=>[Ne,l(C,{label:"公開",modelValue:e(q).value.value,"onUpdate:modelValue":s[6]||(s[6]=o=>e(q).value.value=o),onChange:s[7]||(s[7]=o=>console.log(e(q).value.value))},null,8,["modelValue"])]),_:1})]),_:1}),l(N,null,{default:t(()=>[l(v,{cols:"12",class:"btns-nonstart"},{default:t(()=>[P.value?R("",!0):(c(),_(J,{key:0,onClick:s[8]||(s[8]=o=>te())},{default:t(()=>[O("開始寫譜")]),_:1}))]),_:1})]),_:1}),l(N,{id:"scoreArea",class:"h-100"},{default:t(()=>[(c(!0),V(b,null,A(e(y).value.value,(o,a)=>(c(),V(b,{key:a},[l(v,{cols:"2",class:ge(["instruments w-100",{displayNone:a%2==1&&e(le)}])},{default:t(()=>[Ce,Me,Ue,He,Te]),_:2},1032,["class"]),l(v,{cols:"10",xl:"5",class:"section v-col"},{default:t(()=>[u("div",qe,"section - "+x(a+1),1),u("div",Fe,[(c(!0),V(b,null,A(o,(F,i)=>(c(),V("div",{class:"beat w-100",key:i},[u("div",Ke,"beat - "+x(i+1),1),u("div",De,[u("div",Je,[(c(!0),V(b,null,A(F,(Z,n)=>(c(),_(C,{class:"n-HiHat-note",key:n,value:!0,modelValue:e(y).value.value[a][i][n],"onUpdate:modelValue":f=>e(y).value.value[a][i][n]=f,onChange:f=>console.log(`${a+1}-${i+1}-${n+1}`,e(y).value.value[a][i][n])},null,8,["modelValue","onUpdate:modelValue","onChange"]))),128))]),u("div",Oe,[(c(!0),V(b,null,A(F,(Z,n)=>(c(),_(C,{class:"n-snare-note",key:n,value:!0,modelValue:e(B).value.value[a][i][n],"onUpdate:modelValue":f=>e(B).value.value[a][i][n]=f,onChange:f=>console.log(`${a+1}-${i+1}-${n+1}`,e(B).value.value[a][i][n])},null,8,["modelValue","onUpdate:modelValue","onChange"]))),128))]),u("div",Re,[(c(!0),V(b,null,A(F,(Z,n)=>(c(),_(C,{class:"n-kick-note",key:n,value:!0,modelValue:e(k).value.value[a][i][n],"onUpdate:modelValue":f=>e(k).value.value[a][i][n]=f,onChange:f=>console.log(`${a+1}-${i+1}-${n+1}`,e(k).value.value[a][i][n])},null,8,["modelValue","onUpdate:modelValue","onChange"]))),128))])])]))),128))])]),_:2},1024)],64))),128)),l(v,{cols:"12",class:"btns-start"},{default:t(()=>[P.value?(c(),_(J,{key:0,id:"btn-plus",onClick:s[9]||(s[9]=o=>ue()),disabled:!h.value,"prepend-icon":"mdi-plus"},{default:t(()=>[O("新增小節")]),_:1},8,["disabled"])):R("",!0),P.value?(c(),_(J,{key:1,type:"submit",loading:e(X),disabled:!h.value,color:"green"},{default:t(()=>[O("上傳鼓譜")]),_:1},8,["loading","disabled"])):R("",!0)]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1}))}},xe=ne(Ee,[["__scopeId","data-v-d8a07592"]]);export{xe as default};
