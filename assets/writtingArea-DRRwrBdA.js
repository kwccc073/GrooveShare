import{aa as ve,ab as me,_ as pe,R as ge,x as O,$ as i,a0 as h,c as o,a5 as e,a1 as u,af as fe,W as _,ai as he,aj as Ve,ag as E,a9 as y,a6 as N,J as P,ao as C,a8 as $,aW as _e,a4 as r,a7 as le,ak as ye,al as be}from"./index-Bbs5bw23.js";import{b as Se}from"./breadcrumbs-CUbC_Vsi.js";import{c as ke,a as L,e as R,f as p,g as M,u as Be,d as v,V as Ae}from"./index.esm-C1cvhLwL.js";import{V as W,a as m}from"./VRow-DLXOropG.js";import{V as j}from"./VAutocomplete-C7GHHwB5.js";import{V as U}from"./VCheckbox-K6i23h3z.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./filter-ibMnHcIJ.js";import"./VMenu-r2juey3n.js";const c=w=>(ye("data-v-68044349"),w=w(),be(),w),$e=c(()=>r("span",null,"演奏/演唱者：",-1)),we=c(()=>r("span",null,"歌名：",-1)),Ne=c(()=>r("span",null,"曲風：",-1)),Pe=c(()=>r("span",null,"BPM：",-1)),Ce=c(()=>r("span",null,"拍號：",-1)),Me=c(()=>r("span",null,"/",-1)),Ue=c(()=>r("span",null,"隱私狀態：",-1)),He=c(()=>r("div",{class:"row-name-section"},null,-1)),Te=c(()=>r("div",{class:"row-name-beat"},null,-1)),qe=c(()=>r("div",{class:"row-name-instrument"},"Hi-Hat",-1)),Fe=c(()=>r("div",{class:"row-name-instrument"},"小鼓",-1)),Ke=c(()=>r("div",{class:"row-name-instrument"},"大鼓",-1)),De={class:"sectionTitle"},Je={class:"allBeats"},Oe={class:"beatTile"},Ee={class:"allNoteAreas"},Le={class:"HiHat-area noteArea w-100 d-flex"},Re={class:"snare-area noteArea w-100 d-flex"},We={class:"kick-area noteArea w-100 d-flex"},je={__name:"writtingArea",setup(w){const{apiAuth:se}=he(),z=me(),Q=pe(),oe=Q.account,H=Ve(),{xl:te}=ge(),G=["流行","龐克","金屬","後搖","慢搖","民謠","爵士","其他"],X=[2,3,4,6,9],Y=[2,4,8],V=O(!1),Z=window.matchMedia("(orientation: portrait)");function x(t){t.matches?(console.log("直向模式"),alert("建議將裝置轉為橫向")):console.log("橫向模式")}Z.addEventListener("change",x),x(Z);const re=ke({singer:L().required("演唱者必填-schema"),songTitle:L().required("歌名必填-schema"),songStyle:L().required("曲風必填-schema").test("isSongStyle","曲風分類錯誤-schema",t=>G.includes(t)),BPM:R().typeError("格式錯誤，只能為數字-schema").required("BPM必填-schema"),signatureBeat:R().required("拍號必填").test("issignatureBeat","拍號錯誤",t=>X.includes(t)),signatureNote:R().required("拍號必填").test("issignatureNote","音符拍數錯誤",t=>Y.includes(t)),scoreHiHat:p().of(p().of(p().of(M()))),scoreSnare:p().of(p().of(p().of(M()))),scoreKick:p().of(p().of(p().of(M()))),isPublic:M()}),{handleSubmit:ue,isSubmitting:I}=Be({validationSchema:re,initialValues:{singer:"",songTitle:"",songStyle:"",BPM:0,signatureBeat:4,signatureNote:4,scoreHiHat:[],scoreSnare:[],scoreKick:[],isPublic:!0}}),T=v("singer"),q=v("songTitle"),F=v("songStyle"),K=v("BPM"),g=v("signatureBeat"),ee=v("signatureNote"),b=v("scoreHiHat"),k=v("scoreSnare"),B=v("scoreKick"),D=v("isPublic"),S=O(16),A=O(!1),ne=()=>{Q.isLogin||(alert("請先登入會員"),H.push("/")),A.value=!0,b.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),k.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),B.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),V.value=!V.value},ie=()=>{alert("確定要離開寫譜專區嗎？"),H.push("/profile")},de=()=>{b.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),k.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),B.value.value.push(Array.from({length:g.value.value},()=>Array.from({length:S.value/4},()=>!1))),console.log("新增小節")},ce=ue(async t=>{var l,s;try{const a=new FormData;a.append("editor",oe),a.append("singer",t.singer),a.append("songTitle",t.songTitle),a.append("songStyle",t.songStyle),a.append("BPM",t.BPM),a.append("signatureBeat",t.signatureBeat),a.append("signatureNote",t.signatureNote),a.append("scoreHiHat",JSON.stringify(t.scoreHiHat)),a.append("scoreSnare",JSON.stringify(t.scoreSnare)),a.append("scoreKick",JSON.stringify(t.scoreKick)),a.append("isPublic",t.isPublic),await se.post("/song",a),z({text:"建立歌曲成功",snackbarProps:{color:"green"}}),H.push("/myScore")}catch(a){console.log(a),z({text:((s=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:s.message)||"建立歌曲發生錯誤",snackbarProps:{color:"red"}})}});return(t,l)=>(i(),h(_,null,[o(e(Se)),o(Ae,{onSubmit:fe(e(ce),["prevent"]),disabled:e(I)},{default:u(()=>[o(W,{id:"songInformation"},{default:u(()=>[o(m,{class:"v-col",cols:"12",md:"6"},{default:u(()=>[$e,o(E,{placeholder:"請輸入演奏/演唱者",modelValue:e(T).value.value,"onUpdate:modelValue":l[0]||(l[0]=s=>e(T).value.value=s),"error-messages":e(T).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),o(m,{class:"v-col",cols:"12",md:"6"},{default:u(()=>[we,o(E,{placeholder:"請輸入歌名",modelValue:e(q).value.value,"onUpdate:modelValue":l[1]||(l[1]=s=>e(q).value.value=s),"error-messages":e(q).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),o(m,{class:"v-col",cols:"6",xl:"3"},{default:u(()=>[Ne,o(j,{label:"請選擇曲風",items:G,modelValue:e(F).value.value,"onUpdate:modelValue":l[2]||(l[2]=s=>e(F).value.value=s),"error-messages":e(F).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),o(m,{class:"v-col",cols:"6",xl:"3"},{default:u(()=>[Pe,o(E,{placeholder:"請輸入BPM",type:"number",min:"0",modelValue:e(K).value.value,"onUpdate:modelValue":l[3]||(l[3]=s=>e(K).value.value=s),"error-messages":e(K).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),o(m,{class:"v-col",cols:"6",xl:"3",id:"signature"},{default:u(()=>[Ce,o(j,{items:X,modelValue:e(g).value.value,"onUpdate:modelValue":l[4]||(l[4]=s=>e(g).value.value=s),disabled:V.value},null,8,["modelValue","disabled"]),Me,o(j,{items:Y,modelValue:e(ee).value.value,"onUpdate:modelValue":l[5]||(l[5]=s=>e(ee).value.value=s),disabled:V.value},null,8,["modelValue","disabled"])]),_:1}),o(m,{class:"v-col",cols:"6",xl:"3"},{default:u(()=>[Ue,o(U,{label:"公開",modelValue:e(D).value.value,"onUpdate:modelValue":l[6]||(l[6]=s=>e(D).value.value=s),onChange:l[7]||(l[7]=s=>console.log(e(D).value.value))},null,8,["modelValue"])]),_:1})]),_:1}),o(W,null,{default:u(()=>[o(m,{cols:"12",class:"btns-nonstart"},{default:u(()=>[A.value?C("",!0):(i(),y(P,{key:0,onClick:l[8]||(l[8]=s=>ne()),color:"black"},{default:u(()=>[N("開始寫譜")]),_:1}))]),_:1})]),_:1}),o(W,{id:"scoreArea",class:"h-100"},{default:u(()=>[(i(!0),h(_,null,$(e(b).value.value,(s,a)=>(i(),h(_,{key:a},[o(m,{cols:"2",class:_e(["instruments w-100",{displayNone:a%2==1&&e(te)}])},{default:u(()=>[He,Te,qe,Fe,Ke]),_:2},1032,["class"]),o(m,{cols:"10",xl:"5",class:"section v-col"},{default:u(()=>[r("div",De,"section - "+le(a+1),1),r("div",Je,[(i(!0),h(_,null,$(s,(J,d)=>(i(),h("div",{class:"beat w-100",key:d},[r("div",Oe,"beat - "+le(d+1),1),r("div",Ee,[r("div",Le,[(i(!0),h(_,null,$(J,(ae,n)=>(i(),y(U,{class:"n-HiHat-note",key:n,value:!0,modelValue:e(b).value.value[a][d][n],"onUpdate:modelValue":f=>e(b).value.value[a][d][n]=f,onChange:f=>console.log(`${a+1}-${d+1}-${n+1}`,e(b).value.value[a][d][n])},null,8,["modelValue","onUpdate:modelValue","onChange"]))),128))]),r("div",Re,[(i(!0),h(_,null,$(J,(ae,n)=>(i(),y(U,{class:"n-snare-note",key:n,value:!0,modelValue:e(k).value.value[a][d][n],"onUpdate:modelValue":f=>e(k).value.value[a][d][n]=f,onChange:f=>console.log(`${a+1}-${d+1}-${n+1}`,e(k).value.value[a][d][n])},null,8,["modelValue","onUpdate:modelValue","onChange"]))),128))]),r("div",We,[(i(!0),h(_,null,$(J,(ae,n)=>(i(),y(U,{class:"n-kick-note",key:n,value:!0,modelValue:e(B).value.value[a][d][n],"onUpdate:modelValue":f=>e(B).value.value[a][d][n]=f,onChange:f=>console.log(`${a+1}-${d+1}-${n+1}`,e(B).value.value[a][d][n])},null,8,["modelValue","onUpdate:modelValue","onChange"]))),128))])])]))),128))])]),_:2},1024)],64))),128)),o(m,{cols:"12",class:"btns-start"},{default:u(()=>[A.value?(i(),y(P,{key:0,id:"btn-close",onClick:l[9]||(l[9]=s=>ie()),disabled:!V.value,"prepend-icon":"mdi-close",elevation:"0",color:"red"},{default:u(()=>[N("離開")]),_:1},8,["disabled"])):C("",!0),A.value?(i(),y(P,{key:1,id:"btn-plus",onClick:l[10]||(l[10]=s=>de()),disabled:!V.value,"prepend-icon":"mdi-plus",elevation:"0"},{default:u(()=>[N("新增小節")]),_:1},8,["disabled"])):C("",!0),A.value?(i(),y(P,{key:2,id:"btn-upload",type:"submit",loading:e(I),disabled:!V.value,color:"black","prepend-icon":"mdi-upload-multiple",elevation:"0"},{default:u(()=>[N("上傳")]),_:1},8,["loading","disabled"])):C("",!0)]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])],64))}},aa=ve(je,[["__scopeId","data-v-68044349"]]);export{aa as default};
